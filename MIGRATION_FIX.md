# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ Render

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

```
The column `User.pushSubscription` does not exist in the current database.
```

–≠—Ç–∞ –æ—à–∏–±–∫–∞ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—è `pushSubscription` –Ω–µ –±—ã–ª–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –Ω–∞ production –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –®–∞–≥ 1: –ó–∞–ø—É—à—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ GitHub

–ú–∏–≥—Ä–∞—Ü–∏—è —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞ –∏ –∑–∞–∫–æ–º–º–∏—á–µ–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ. –¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –∑–∞–ø—É—à–∏—Ç—å:

```bash
git push
```

### –®–∞–≥ 2: Render –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç

–ü–æ—Å–ª–µ push –Ω–∞ GitHub:

1. Render –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
2. –ó–∞–ø—É—Å—Ç–∏—Ç –Ω–æ–≤—ã–π –¥–µ–ø–ª–æ–π
3. –í—ã–ø–æ–ª–Ω–∏—Ç –∫–æ–º–∞–Ω–¥—É `prisma migrate deploy`
4. –ü—Ä–∏–º–µ–Ω–∏—Ç –º–∏–≥—Ä–∞—Ü–∏—é `20251025060154_add_push_subscription`

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ Render

–í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:

```
Applying migration `20251025060154_add_push_subscription`
The following migration(s) have been applied:
migrations/
  ‚îî‚îÄ 20251025060154_add_push_subscription/
    ‚îî‚îÄ migration.sql
```

---

## üîç –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (–µ—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª)

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ Render Shell

1. –û—Ç–∫—Ä–æ–π—Ç–µ Render Dashboard
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à Web Service
3. –û—Ç–∫—Ä–æ–π—Ç–µ **Shell** (–≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É)
4. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:

```bash
npx prisma migrate deploy
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞–ø—Ä—è–º—É—é –≤ –ë–î

1. –û—Ç–∫—Ä–æ–π—Ç–µ Render Dashboard ‚Üí PostgreSQL Database
2. –û—Ç–∫—Ä–æ–π—Ç–µ **Connect** ‚Üí —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ **External Database URL**
3. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –ë–î —á–µ—Ä–µ–∑ `psql`:

```bash
psql <–≤–∞—à_database_url>
```

4. –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL:

```sql
ALTER TABLE "User" ADD COLUMN "pushSubscription" TEXT;
```

5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:

```sql
\d "User"
```

–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∫–æ–ª–æ–Ω–∫–∞ `pushSubscription | text | nullable`

---

## üöÄ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å –Ω–∞ Render:**

   - Dashboard ‚Üí Web Service ‚Üí Manual Deploy ‚Üí Deploy latest commit

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**

   ```
   Application is running on: http://localhost:10000
   ```

3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ WebSocket:**
   - –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —á–∞—Ç—É
   - –î–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫

---

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã

–í Render Shell –∏–ª–∏ —á–µ—Ä–µ–∑ psql:

```sql
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_name = 'User';
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—Å–µ –∫–æ–ª–æ–Ω–∫–∏:

- `id`
- `phone`
- `name`
- `isOnline`
- `lastSeen`
- `pushSubscription` ‚Üê —ç—Ç–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è!
- `createdAt`
- `updatedAt`

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
const socket = io("https://gift-app-api.onrender.com", {
  auth: { token: "–≤–∞—à_jwt_token" },
});

socket.on("connect", () => console.log("‚úÖ Connected"));
socket.on("connect_error", (err) => console.error("‚ùå Error:", err));
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ push-–ø–æ–¥–ø–∏—Å–∫—É

```bash
curl -X POST https://gift-app-api.onrender.com/push/subscribe \
  -H "Authorization: Bearer –≤–∞—à_—Ç–æ–∫–µ–Ω" \
  -H "Content-Type: application/json" \
  -d '{
    "endpoint": "test",
    "keys": {
      "p256dh": "test",
      "auth": "test"
    }
  }'
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å:

```json
{
  "success": true,
  "message": "Push subscription saved"
}
```

---

## üêõ –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –µ—Å—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:**

   ```bash
   ls prisma/migrations/
   # –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: 20251025060154_add_push_subscription
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**

   ```bash
   cat prisma/migrations/20251025060154_add_push_subscription/migration.sql
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –¥–µ–ø–ª–æ—è –Ω–∞ Render:**

   - Dashboard ‚Üí Logs ‚Üí Deploy logs
   - –ò—â–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ —Å "prisma migrate deploy"

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ Render:**
   - `DATABASE_URL` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º
   - –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ `.env.example`

---

## ‚úÖ –ò—Ç–æ–≥

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö —à–∞–≥–æ–≤:

- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –Ω–∞ production
- ‚úÖ –ö–æ–ª–æ–Ω–∫–∞ `pushSubscription` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚úÖ WebSocket —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç üéâ
